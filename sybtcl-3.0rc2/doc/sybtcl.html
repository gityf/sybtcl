<!-- manual page source format generated by PolyglotMan v3.0.7, -->
<!-- available via anonymous ftp from ftp.cs.berkeley.edu:/ucb/people/phelps/tcltk/rman.tar.Z -->

<HTML>
<HEAD>
<TITLE>"Sybtcl"(n)</TITLE>
</HEAD>
<BODY bgcolor=white>
<A HREF="#toc">Table of Contents</A><P>
 
<H2><A NAME="sect0" HREF="#toc0">Name </A></H2>
Sybtcl - Sybase SQL Server access commands for Tcl  
<H2><A NAME="sect1" HREF="#toc1">Introduction 
</A></H2>
<P>
Sybtcl is a collection of Tcl  commands and a Tcl global array that provides 
access to a Sybase Server. Each Sybtcl command generally invokes several 
 Sybase Open Client (a.k.a. DB-Library) library functions. Programmers using 
Sybtcl should be familar with basic concepts of DB-Library programming. 
   <P>
 
<H2><A NAME="sect2" HREF="#toc2">Sybtcl Commands </A></H2>

<DL>

<DT><B>sybconnect <I>login-name password ?server? ?appname? ?ifile? 
?charset? </I></B>  </DT>
<DD> <BR>
Connect to a Sybase server using <I>login-name </I> and <I>password 
</I>. If <I>server </I> is specified, then an attempt will be made to login to the 
named Sybase server.  If <I>server </I> is not specified, then the  environment 
variable <I>DSQUERY </I> is used to determine a server; if <I>DSQUERY </I> is not set, 
sybconnect will try to connect to the Sybase server named <I>SYBASE </I>.  If 
an <I>appname </I> is specified, then that value is passed to the server to display 
during a process list. If <I>ifile </I> is specified, that file is used to resovle 
server addresses; if not specified, the normal $SYBASE/interfaces file 
is used. If <I>charset </I> is specified, the charset should reference a vaild 
character set available on your Sybase installation.   See the $SYBASE/charsets 
directory for charsets supported on your  installation.  <P>
<I>Login-name </I> and 
<I>password </I> are required parameters.  All other parameters are optional postitional 
parameters.  For example, to specify the <I>ifile </I> paramater, <I>server </I> and 
<I>appname </I> must also be specified.  Optional parameters may be a null string, 
in which case the default value is used.  <P>
A handle is returned and should 
be used for all other Sybtcl commands using this connection.  Multiple 
connections to the same or different servers are allowed, up to a maximum 
of 50 total connections. Sybconnect raises a Tcl error if the connection 
 is not made for any reason (login or password incorrect, server not found 
in the Sybase interfaces file, network unavailable, etc.).  <P>
</DD>

<DT><B>syberrhandler 
<I>?tclproc? </I></B>  </DT>
<DD> <BR>
Set a Tcl procedure to be called upon any DB-Lib error.  The 
Tcl procedure should exist, and take the following arguments to the procedure: 
 <blockquote></DD>

<DT><I>handle</I>  </DT>
<DD> <BR>
The Sybtcl handle associated with the error condition.  Handle 
may be a null string, such as in the case of an error occurring during 
sybconnect. </DD>

<DT><I>severity</I>  </DT>
<DD>The Sybase severity level of the error. </DD>

<DT><I>dberr</I>  </DT>
<DD>The 
Sybase DB-Lib error code. </DD>

<DT><I>oserr</I>  </DT>
<DD>The operating system error code. </DD>

<DT><I>dberrstr</I> 
 </DT>
<DD>The DB-Lib error string associated with the error code. </DD>

<DT><I>oserrstr</I>  </DT>
<DD>The operating 
system error string associated with the error. </DD>
</DL>
 </blockquote>
Example:  <P>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;proc err_handler 
{handle severity dberr oserr dberrstr oserrstr} {  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;    puts "error: $handle 
$severity $dberr $oserr $dberrstr $oserrstr"  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;    return 1  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;}  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;syberrhandler 
err_handler  <BR>
 <P>
The procedure may also return an integer value to indicate 
an action to perform:  <blockquote>
<DL>

<DT>"0"  </DT>
<DD>print an error message and abort the  program 
immediately. </DD>

<DT>"1"   </DT>
<DD>continue by returning a "FAIL" condition to the currently 
executing  DB-Lib function. </DD>

<DT>"2"  </DT>
<DD>cancel the operation that caused the error 
if a result of a timeout condition.  For any other case, this value is 
considered as "0",  immediate program termination. </DD>

<DT>"3"   </DT>
<DD>continue to wait 
for one additional time out  period if a result of a timeout condition. 
 For any other case, this value is  considered as "0", immediate program 
termination.  </DD>
</DL>
 </blockquote>
If no value is returned, or any other value is return, Sybtcl 
treats the return value as "1" (continue).  <P>
Syberrhandler called without 
an argument returns the current error handler. If called with a null string, 
the error handler is disabled.  <P>

<DL>

<DT><B>sybmsghandler <I>?tclproc? </I></B>  </DT>
<DD> <BR>
Set a Tcl procedure 
to be called upon any server message.  The Tcl procedure should exist, 
and take the following arguments to the procedure:  <blockquote></DD>

<DT><I>handle</I>  </DT>
<DD> <BR>
The Sybtcl 
handle associated with the error condition.  </DD>

<DT><I>msgno</I>  </DT>
<DD>The Sybase server message 
number. </DD>

<DT><I>msgstate</I>  </DT>
<DD>The Sybase server message state. </DD>

<DT><I>severity</I>  </DT>
<DD>The Sybase 
severity level of the error. </DD>

<DT><I>msgtext</I>  </DT>
<DD>The server message text. </DD>

<DT><I>svrname</I>  
</DT>
<DD>The name of the server generating the message. </DD>

<DT><I>procname</I>  </DT>
<DD>The name of the 
procedure generating the message, if any. </DD>

<DT><I>line</I>  </DT>
<DD>The line numer of the procedure 
generating the message, if any. </DD>
</DL>
 </blockquote>
Example:  <P>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;proc msg_handler {handle msgno 
msgstate severity msgtext svrname procname line} {  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;    puts "msg: $handle 
$msgno $msgstate $severity $msgtext $svrname $procname $line"  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;}  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;syberrhandler 
msg_handler  <BR>
 <P>
Sybghandler called without an argument returns the current 
message handler. If called with a null string, the message handler is disabled. 
 <P>

<DL>

<DT><B>sybuse <I>handle ?dbname? </I></B>  </DT>
<DD> <BR>
Return the database name currently in use.  
If <I>dbname </I> is specified, then attempt to use the named database.   <I>Handle 
</I> must be a valid handle previously opened with sybconnect. If <I>dbname </I> is 
used successfully, the dbname is returned. Sybuse raises a Tcl error if 
the handle specified is not open or the database name specified could 
not be used.  <P>
</DD>

<DT><B>sybsql <I>handle sql-command  ?-async? </I></B>  </DT>
<DD> <BR>
Send the Sybase Transact 
SQL statements <I>sql-command </I> to the server. <I>Handle </I> must be a valid handle 
previously opened with sybconnect. If the optional argument <B>-async </B> is specified, 
then the SQL is sent to the server without waiting for a response and 
sybsql will return immediately with the value "PENDING".  The sybpoll command 
can be used to check the status of the server results; sybnext must be 
called to determine if result rows were generated.  If <B>-async </B> is omitted, 
then sybsql will wait until the server has responed. Sybsql will return 
"REG_ROW" if the SQL statements generated return rows, "NO_MORE_ROWS" 
if the SQL commands executed, but no rows were returned in the first or 
only set of results.  The <B>sybmsg </B> array index <I>retstatus </I> is set with the 
return code of a stored procedure, if any; the  <I>nextow </I> index is also 
set to the value returned by sybsql.  <P>
Multiple SQL statements may be specified 
in <I>sql-command </I>.   <I>Sybnext </I> allows retrieval of return rows generated; <I>Sybretval 
</I> allows retrieval of any return values from stored procedures. See notes 
regarding stored procedure output variables.  <P>
Sybsql performs an implicit 
<I>sybcancel </I> if any results are still pending from the last execution of 
sybsql. Sybsql raises a Tcl error if the handle specified is not open, 
or if the SQL commands are syntactically incorrect.    <P>
Table inserts made 
with sybsql should follow conversion rules in the Sybase Commands Reference 
manual (image or binary data is hexadecimal string preceded with "0x"; 
datetime should be a recognizable date, etc. The SQL Server CONVERT function 
may be used to force conversions.  <P>
</DD>

<DT><B>sybpoll <I>handle  ?timeout?  ?-all? </I></B>  </DT>
<DD> 
<BR>
Return a list of Sybtcl handles that have results waiting. <I>Handle </I> must 
be a valid handle previously opened with sybconnect. If the last SQL results 
are not ready, a null string is returned.  An optional <I>timeout </I> value in 
milliseconds may be specified, which is the amount of time the sybpoll 
will wait before returning a result.   If the timeout value is -1, sybpoll 
will wait until results are available before returning.  The default timeout 
value is 0, which polls and  immediately returns.  <P>
The option <I>-all </I> may 
be specified, in which all handles that have been executed with -async 
are checked, and a Tcl list of all handles that have results waiting are 
returned.  When <I>-all </I> is combined with a timeout of  -1, then sybpoll waits 
until any async handle has results waiting, and then returns a list of 
all handles that have results waiting. If the last SQL statements executed 
with <I>handle </I> were not sent as -async with sybsql, sybpoll returns a null 
string.  <P>
</DD>

<DT><B>sybevent <I>handle  ?script? </I></B>  </DT>
<DD> <BR>
Arrange to run a script when server 
data is available. <I>Handle </I> must be a valid handle previously opened with 
sybconnect. <I>Sybsql </I> must have previously been executed, without or without 
 <I>-async </I> mode.  The event handler script should execute <I>sybnext </I> in order 
to process available data.  The event handler may be executed during any 
phase of result processing including REG_ROW, compute rows, NO_MORE_ROWS, 
and NO_MORE_RESULTS.  <P>
If <I>?script? </I> is not specified, the existing event 
handler script is returned.   If <I>?script? </I> is a null string, the event 
handler is removed.  The  event handler is also removed at end of all results 
for the current SQL statement.  <P>
For the event handler to actually run, 
the Tcl interpreter must be processing events.  Events can be processed 
on demand by executing the Tcl <B>update </B> command, or until a variable is 
set with the  <B>vwait </B> command.  Events are also processed while a Tk (wish) 
program is waiting on user input.  <P>
Sybtcl's callback handler is greedy; 
it continues to invoke the sybevent script while data rows are available. 
 To allow other Tcl events to be processed,  set <I>sybmsg(bgevents) </I> to 
<B>idletasks </B> or <B>all </B>.    <P>
</DD>

<DT><B>sybnext <I>handle  ?commands?  ?substitution_character? 
 ?tclvar colnum ...? </I></B>  </DT>
<DD> <BR>
Return the next row from the last SQL statements 
executed with sybsql as a Tcl list. <I>Handle </I> must be a valid handle previously 
opened with sybconnect. Sybnext raises a Tcl error if the handle specified 
is not open. A null string is returned if there are no more rows in the 
current set of results. The Tcl list that is returned by sybnext contains 
the values of the selected columns in the order specified by <I>select </I>.  
<P>
If the SQL statements where executed with the -async option of sybsql, 
then sybnext will wait until results are available.  Sybpoll may be used 
to check for results in a non-blocking manner.   Any errors in the SQL statements 
will cause sybnext to fail.  <P>
The optional <I>commands </I> argument allows sybnext 
to repeatedly fetch rows and execute <I>commands </I> for each row. Substitutions 
are made on <I>commands </I> before passing it to Tcl_Eval() for each row.  An 
optional argument consisting of a single character can be specified for 
a column number substitution character.  If none is specified,  the character 
'@' will be used to denote the substitution character.    If the substitution 
character is a null string, no column substitutions will be performed 
on the <I>commands </I> string. Sybnext interprets the substitution character 
followed by a number (<B>@n </B>) in <I>commands </I> as a result column specification. 
 For example, <B>@1, @2, @3 </B> refer to the first, second, and third columns 
in the result.  <B>@0 </B> refers to the entire result row, as a Tcl list. Substitution 
columns may appear in any order, or more than once in the same command. 
Substituted columns are inserted into the <I>commands </I> string as proper list 
elements, i.e., one space will be added before and after the substitution 
and column values with embedded spaces are enclosed by {} if needed.  <P>
Tcl 
variables may also be set for <I>commands </I> on each row that is processed. 
 Tcl variables are specified after the <I>substitution_character </I>, consisting 
of matching pairs of Tcl variable names and a column numbers. Column number 
may be "0", in which the Tcl variable is set to the entire result row 
as a Tcl list.  Column numbers must be less than or equal to the number 
of columns in the SQL result set.  <P>
Tcl variable column pairs may also be 
specified as a list argument.  <P>
Sybnext will execute <I>commands </I> until NO_MORE_ROWS. 
 If additional results are pending, subsequent sybnext commands will retrieve 
the next set of results.    <P>
A Tcl error is raised if a column substitution 
number is greater than the number of columns in the results.   Note that 
Transact-SQL "compute" statements are considered to be part  of the current 
select's result set, and thus, a different number of columns may be returned, 
causing the sybnext column substitution to fail when the compute row is 
returned.   If the commands execute <B>break </B>, sybnext execution is interrupted 
and returns with TCL_OK.  Remaining rows may be fetched with a subsequent 
sybnext command. If the commands execute <B>return </B> or <B>continue </B>, the remaining 
commands are skipped and sybnext execution continues with the next row. 
Sybnext will raise a Tcl error if the <I>commands </I> return an error. Commands 
should be enclosed in "" or {}.  <P>
The <B>sybmsg </B> array index <I>retstatus </I> is 
set with the return code of a stored procedure, if one was executed in 
the last SQL command to sybsql; the index <I>nextrow </I> is set to  one of several 
values, depending on the results of sybnext.  Refer to the section "SERVER 
MESSAGE AND ERROR INFORMATION" for information about how the <I>nextrow </I> 
value is set.  <P>
When <I>sybmsg </I> array element <I>binaryashex </I> is set  to '1', 'yes', 
or 'true',  sybnext performs conversions for image and binary data.  Data 
is returned  as a hexadecimal string, without a leading "0x".  Use the 
SQL Server function CONVERT to force a specific conversion.  <P>
The <B>sybmsg 
</B> array index <I>maxtext </I> limits the amount of text or image data returned 
for each column returned.  The default is 32768 bytes.    <P>
The <B>sybmsg </B> array 
index <I>nullvalue </I> can be set to specify the value returned when a column 
is null.  The default is "0" for numeric data, and "" for other datatypes. 
 <P>
</DD>

<DT><B>sybcols <I>handle </I></B>  </DT>
<DD> <BR>
Return the names of the columns from the last sybnext 
or sybretval command   as a Tcl list.  Sybcols returns the column name 
used in the  SQL select command; a null string for any column that is 
an aggregate function (count, sum, avg, min, max) in a regular row.  A 
compute row column name is returned as <I>function(column-name) </I>. Sybcols may 
be used after <I>sybretval </I>, in which the output variable names are returned 
(see notes).    <P>
The <B>sybmsg </B> array index <I>collengths </I> is set to a Tcl list 
corresponding to the lengths of the columns; index <I>coltypes </I> is set to 
a Tcl list corresponding to the types of the columns. Sybcols raises a 
Tcl error if the handle specified is not open.  <P>
</DD>

<DT><B>sybcancel <I>handle </I></B>  </DT>
<DD> <BR>
Cancel 
any pending results from the last sybsql command.   <I>Handle </I> must be a valid 
handle previously opened with sybconnect. Sybcancel may  be used before 
sybnext exhausts all results.   Sybcancel raises a Tcl error if the handle 
specified is not open.  <P>
</DD>

<DT><B>sybretval <I>handle </I></B>  </DT>
<DD> <BR>
Return a Tcl list of the return 
values from a stored procedure.   <I>Handle </I> must be a valid handle previously 
opened with sybconnect. If a stored procedure also returns rows, sybnext 
must have previously been called until NO_MORE_ROWS was encountered before 
sybretval can access the return values.   The <B>sybmsg </B> array index <I>retstatus 
</I>  contains the return code from the stored procedure. Sybretval raises 
a Tcl error if the handle specified is not open. See notes regarding stored 
procedure output variables.  <P>
</DD>

<DT><B>sybwritetext  <I>handle object colnum [ -variable 
varname | -file filename | filename ] ?-nolog? </I></B>  </DT>
<DD> <BR>
Write the contents of a 
variable or file to a TEXT or IMAGE column. <I>Handle </I> must be a valid handle 
previously opened with sybconnect. <I>Object </I> is the table and column name 
in the format <B>table.column </B>. <I>Colnum </I> is the relative position of the column 
from the last  <B>select </B>.  <I>varname </I> is the name of a Tcl variable containing 
data, or <I>filename </I> is the name of the file that contains the text or image 
data to write into the column.  Text and image writes are logged by default, 
<B>-nolog </B> may be specified to disable logging (the database must have previously 
been set with a no log option.) If neither <B>-variable </B> or <B>-file </B> is specified, 
the argument is interpreted as a filename.  <P>
Sybwritetext can only be used 
in a specific sequence with other sybsql commands.  Refer to the Sybase 
DB-Library documentation for  dbwritetext() and the DB-Library Reference 
Supplement discussion on text/image handling.  <P>
For example (assume $hand 
is an open handle, using the "pubs" database):<B>  </B><P>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;sybsql $hand "insert into 
au_pix (au_id) values ('111-22-3333')"  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;sybsql $hand "update au_pix set pic 
= null where au_id = '111-22-3333'"  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;sybsql $hand "select pic from au_pix 
where au_id = '111-22-3333'"  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;sybwritetext $hand au_pix.pic 1 image.file -nolog 
  <BR>
 <P>
An update to an existing text or image column can be made using the 
last two commands from the above example. Sybwritetext returns a integer 
number upon successful completion of the number of bytes written to the 
text/image column.  <P>
Sybwritetext raises a Tcl error for a variety of reasons: 
 filename could not be opened or a failure in internal DB-Library routines. 
 Common failures are specifing <B>-nolog </B> when the database does not support 
nolog;  unable to access a valid text pointer  due to invalid <B>object </B> 
or <B>colnum </B>; sybwritetext used out of sequence. Consult <B>sybmsg(msgtext) 
</B> or <B>sybmsg(dberrstr) </B> for information after a failure.  <P>
</DD>

<DT><B>sybreadtext  <I>handle 
[ -variable varname | -file filename | filename ] </I></B>  </DT>
<DD> <BR>
Read the contents of 
a TEXT or IMAGE column and write results into a  variable or a file. <I>Handle 
</I> must be a valid handle previously opened with sybconnect. <I>varname </I> is 
the name of a Tcl variable, or  <I>Filename </I> is the name of a file in which 
to write the text or image data.  Sybreadtext can only be used after the 
successful <B>select </B> of a single text or image column.   If neither <B>-variable 
</B> or <B>-file </B> is specified, the argument is interpreted as a filename. For 
example (assume $hand is an open handle, using the "pubs" database):<B>  
</B><P>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;sybsql $hand "select copy from blurbs where au_id = '486-29-1786'"  <BR>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;sybreadtext 
$hand blurb.txt   <BR>
 <P>
Sybreadtext returns a decimal number upon successful 
completion of the number of bytes read from the text/image column. Sybreadtext 
returns "0" if the last select returned more than one column or no row 
was returned.  <P>
The <B>sybmsg </B> array index <I>maxtext </I> limits the amount of text 
or image data that can be written to a file by sybreadtext.  The default 
is 32768 bytes.    <P>
Sybreadtext raises a Tcl error for a variety of reasons: 
 filename could not be opened, sybreadtext used out of sequence, etc.  
<P>
</DD>

<DT><B>sybclose <I>handle </I></B>  </DT>
<DD>Closes the server connection associated with <I>handle 
</I>.   <I>Handle </I> must be a valid handle previously opened with sybconnect. Sybclose 
returns a null string. Sybclose raises a Tcl error if the handle specified 
is not open.  <P>
</DD>
</DL>
 
<H2><A NAME="sect3" HREF="#toc3">Server Message and Error Information </A></H2>
<P>
Sybtcl creates and 
maintains a Tcl global array to provide feedback of Sybase server messages, 
named <B>sybmsg </B>.  Sybmsg is also used to communicate with the sybtcl interface 
routines to specify null return values and text/image limits. In all cases 
except for <I>nullvalue </I>, <I>fixedchar </I>, <I>floatprec </I>,  <I>dateformat </I>, <I>bgevents 
</I>, <I>bgpollinterval </I> and <I>maxtext </I>,  each element is reset to null upon invocation 
of any sybtcl command, and any  element affected by the command is set. 
 The sybmsg array is shared  among all open sybtcl handles.  Sybmsg should 
be defined with the global statement in any Tcl procedure needing access 
to sybmsg. <P>
Sybmsg elements:  <P>

<DL>

<DT><B>version</B>  </DT>
<DD> <BR>
is set to the version of Sybtcl. 
 <P>
</DD>

<DT><B>nullvalue</B>  </DT>
<DD> <BR>
can be set by the programmer to indicate the string value 
returned for any null result.  Setting <A HREF="man:sybmsg(nullvalue)">sybmsg(nullvalue)</A>
 to "default"  
will return "0" for numeric null data types (integer, float, and money) 
and a  null string for all other data types.  Nullvalue is initially set 
to "default".  <P>
</DD>

<DT><B>fixedchar</B>  </DT>
<DD> <BR>
can be set by the programmer to indicate that 
character datatypes  returned by sybnext should not have trailing spaces 
trimmed from the  value.  Setting sybmsg(fixedchar) to "1", "true", or 
 "yes" will  ensure that all trailing spaces are returned.  The default 
value ("") will cause trailing spaces to be trimmed.  <P>
</DD>

<DT><B>binaryashex</B>  </DT>
<DD> <BR>
can 
be set by the programmer to indicate that binary data types (binary, image) 
should be converted to hexstrings.  Setting sybmsg(binaryashex) to "1", 
"true", or  "yes" will  convert binary types to hex strings. The default 
value ("") will cause binary data to be stored bit-for-bit.  <P>
</DD>

<DT><B>dateformat</B>  
</DT>
<DD> <BR>
can be set by the programmer to indicate formatting for date data types. 
The dateformat string can contain substitution values or literals. Substitions 
are made from the list below; other literals are copied verbatim.  The 
default value is null, which will format dates a default format.  <blockquote></DD>

<DT><B>YYYY</B> 
 </DT>
<DD> <BR>
four digit year, 1900- </DD>

<DT><B>YY</B>  </DT>
<DD> <BR>
two digit year, 00-99 </DD>

<DT><B>MM</B>  </DT>
<DD> <BR>
two digit month, 
1-12 </DD>

<DT><B>MONTH</B>  </DT>
<DD> <BR>
name of month, January-December </DD>

<DT><B>MON</B>  </DT>
<DD> <BR>
month abbreviation, Jan-Dec 
</DD>

<DT><B>DD</B>  </DT>
<DD> <BR>
two digit day, 1-31 </DD>

<DT><B>hh</B>  </DT>
<DD> <BR>
two digit hour, 0-23 </DD>

<DT><B>mm</B>  </DT>
<DD> <BR>
two digit minute, 
0-59 </DD>

<DT><B>ss </B>  </DT>
<DD> <BR>
two digit second, 0-59 </DD>

<DT><B>ms</B>  </DT>
<DD> <BR>
three digit millisecond, 0-999 </DD>

<DT><B>dy</B> 
 </DT>
<DD> <BR>
three digit day of year, 0-365 </DD>

<DT><B>dw</B>  </DT>
<DD> <BR>
one digit day of week, 1-7 (Mon-Sun) 
</DD>
</DL>
 </blockquote>
 <P>

<DL>

<DT><B>bgevents</B>  </DT>
<DD> <BR>
can be set by the programmer to allow or disallow the processing 
of Tcl events while Sybtcl is waiting for server response. Events are processed 
during Sybtcl commands that may wait on server responses:  sybsql (without 
-async option), sybnext (with commands option), sybwritetest, and sybreadtext. 
The default value is "idletasks".  Possible values are:  <blockquote></DD>

<DT><B>idletasks</B>  </DT>
<DD> <BR>
Process 
only events that have been deferred, such as display updates. Similar to 
the Tcl <B>update idletasks </B> command. </DD>

<DT><B>all</B>  </DT>
<DD> <BR>
Process all events. Similar to 
the Tcl <B>update </B> command. </DD>

<DT><B>none</B>  </DT>
<DD> <BR>
Do not process events during Sybtcl commands. 
  </DD>
</DL>
 </blockquote>
 <P>

<DL>

<DT><B>bgpollinterval</B>  </DT>
<DD> <BR>
can be set by the programmer to specify the polling 
interval  in milliseconds while processing background events.  The value 
specified must be an integer between 1 and 1000.  The default bgpollinterval 
value is 200.  Smaller values causes the polling loop to execute more frequently, 
which may cause higer CPU usage.   <P>
</DD>

<DT><B>maxtext</B>  </DT>
<DD> <BR>
can be set by the programmer 
to limit the amount of text or image data returned by sybnext and sybreadtext. 
 The default is 32768 bytes.   The maximum is 2147483647 bytes.  Any value 
less than or equal to zero is ignored.  Any change to maxtext becomes effective 
on the next call to sybsql.  See notes on maxtext usage with sybnext.  <P>
</DD>

<DT><B>handle</B> 
 </DT>
<DD> <BR>
indicates the handle of the last sybtcl command.  Handle is set on every 
sybtcl command (execpt where an invalid handle is used.)  <P>
</DD>

<DT><B>isnull</B>  </DT>
<DD> <BR>
is a 
list of binary elements corresponding to each column element returned 
by sybnext.  Each element is set to "1" if the value is null, "0" if the 
value is not null.  <P>
</DD>

<DT><B>nextrow</B>  </DT>
<DD> <BR>
indicates the results of the last SQL command 
and subsequent next row processing.  Nextrow is set by sybsql and sybnext. 
 Possible values are:  <blockquote></DD>

<DT><B>REG_ROW</B>  </DT>
<DD> <BR>
at least one row is available after execution 
of sybsql, or the results of sybnext returned a row as a Tcl list. </DD>

<DT><B>n</B>  </DT>
<DD> 
<BR>
an integer number, which indicates that last row retrieved by sybnext 
returned a compute row.  The value is the <I>computeid </I>, which is the relative 
compute statement in the last SQL command executed with sybsql. </DD>

<DT><B>NO_MORE_ROWS</B> 
 </DT>
<DD> <BR>
indicates that sybsql executed successfully  but no rows are available, 
or the results of  sybnext did not return a row.  Sybnext will return a 
null string. Return values from a stored procedure, if any, are available 
at this time. If more results are expected, a subsequent execution of sybnext 
will return the first row, if any, from the next  set of results. </DD>

<DT><B>PENDING</B> 
 </DT>
<DD> <BR>
indicates the last execution of sybsql was made with the  "-async" flag. 
 Sybpoll may be used to check the status of results. Sybnext will block 
until results are available.  When sybsql is executed with -async, any errors 
will not be available until the  first execution of sybnext. </DD>

<DT><B>FAIL</B>  </DT>
<DD> <BR>
indicates 
that a server error has occurred.  Appropriate error codes and messages 
are set in the sybmsg indices <I>dberr </I> and <I>dberrstr </I>. Sybnext will return 
a null string. If more results are expected, a subsequent execution of 
sybnext will return the first row, if any, from the next  set of results. 
</DD>

<DT><B>NO_MORE_RESULTS</B>  </DT>
<DD> <BR>
indicates that the final set of results from the last 
execution of sybsql have been processed by sybnext. </DD>
</DL>
 </blockquote>

<DL>

<DT><B>retstatus</B>  </DT>
<DD> <BR>
indicates 
the return code after a stored procedure has executed.  Retstatus is set 
by sybsql or sybnext, whenever a the results of a stored procedure are 
available. </DD>

<DT><B>collengths</B>  </DT>
<DD> <BR>
is a Tcl list of the lengths of the columns returned 
by sybcols.  Numeric columns (Sybase datatypes int, float, etc.) are given 
by the internal  data lengths (e.g., int has a length of 4),  character 
columns lengths are the maximum of any row returned.  Collengths is only 
set by sybcols. </DD>

<DT><B>coltypes</B>  </DT>
<DD> <BR>
is a Tcl list of the types of the columns returned 
by sybcols.   Coltypes is only set by sybcols.  Possible types returned 
are: char, text, binary, image, tinyint, smallint, int, float, real, numeric, 
decimal, bit, money, smallmoney, datetime, smalldatetime. Varchar and varbinary 
data types are reported as char and binary. </DD>

<DT><B>msgno</B>  </DT>
<DD> <BR>
indicates the message 
number from a Sybase Server message. Can be set by any sybtcl command.  
Refer to Sybase documentation for  interpretation. Since each sybtcl command 
may invoke several DB-Lib routines, there is a possiblity that several 
messages may be received from the server.  Sybtcl will  concatenate all 
server message numbers received during one sybtcl command,  separating 
individual numbers by newlines. </DD>

<DT><B>msgtext</B>  </DT>
<DD> <BR>
the message text associated with 
msgno.  Since each sybtcl command may invoke several DB-Lib routines, there 
is a possiblity that several messages may be received from the server. 
 Sybtcl will  concatenate all server messages received during one sybtcl 
command,  separating individual messages by newlines. Output from Transact-SQL 
PRINT statments are collected in msgtext. </DD>

<DT><B>severity</B>  </DT>
<DD> <BR>
indicates the severity 
level from a Sybase Server message or DB-Library routine. Can be set by 
any sybtcl command.  Refer to Sybase documentation for  interpretation. 
</DD>

<DT><B>svrname</B>  </DT>
<DD> <BR>
indicates the name of the Sybase Server that generated a message. 
Can be set by any sybtcl command.   </DD>

<DT><B>procname</B>  </DT>
<DD> <BR>
indicates the name of the 
stored procedure that generated a message. Only set when a stored procedure 
was executed.  Set by sybsql.   </DD>

<DT><B>line</B>  </DT>
<DD> <BR>
indicates the line number of the 
SQL command or stored procedure that generated a message.  Set by sybsql. 
  </DD>

<DT><B>dberr</B>  </DT>
<DD> <BR>
indicates the error number generated by a DB-Library routine. 
Can be set by any sybtcl command.  Refer to Sybase documentation for  interpretation. 
</DD>

<DT><B>dberrstr</B>  </DT>
<DD> <BR>
the error text associated with dberr.  </DD>

<DT><B>oserr</B>  </DT>
<DD> <BR>
indicates an 
operating system specific error number associated with a  DB-Library error. 
Can be set by any sybtcl command.   </DD>

<DT><B>oserrstr</B>  </DT>
<DD> <BR>
the error text associated 
with oserr.  <P>
</DD>

<DT><B>dblibinfo</B>  </DT>
<DD> <BR>
is set to options that were in effect with Sybtcl 
was compiled.  Possible values are: "system10" if linked with Sybase System 
10 DB-Libs or higher,  "ctcompt" if compiled with the CT-Lib compatiblity 
library.  <P>
</DD>
</DL>
 
<H2><A NAME="sect4" HREF="#toc4">Notes </A></H2>
<P>
Tcl errors can also be raised by any sybtcl command if 
a command's internal calls to DB-Library routines fail.  Sybtcl will return 
the name of the  DB-Lib routine that caused an error. <P>
When executing a stored 
procedure with sybsql, be sure to include in the SQL commands a "DECLARE" 
statement for local variables, and specify the local variables as "OUTPUT" 
on the "EXEC" statement. Otherwise, sybretval will not be able to access 
the return values.  If the return variable names are  to be accessed by 
sybcols, use the assignment form of "EXEC", e.g.:<B> 
<DL>

<DT>declare @local-var datatype 
 </B></DT>
<DD> <BR>
exec stored-proc @proc-var-name = @local-var output   <BR>
 <P>
</DD>
</DL>
<P>
If a stored procedure 
is executed with sybsql, and the procedure uses Transact-SQL "PRINT" statements, 
check $sybmsg(msgtext) before executing any other Sybtcl commands.  Otherwise, 
the PRINT output will be lost on the next command.  Multiple PRINT statements 
are separated by newlines in $sybmsg(msgtext). <P>
Sybtcl error and message 
handlers simply populate values in the sybmsg array. The error handler 
always returns INT_CANCEL. <P>
To use the <B>-nolog </B> feature of sybwritetext, the 
following option must have been set on the database: <P>
<tt> </tt>&nbsp;<tt> </tt>&nbsp;<B>sp_dboption 'yourdbname', 
'select into/bulkcopy', 'true' </B>  <P>
<P>
The limit of the number of simultaneous connections 
is artificial, based on a fixed table in sybtcl.  Change the source  <I>#define</I> 
SYBTCLPROCS if more are needed.    <P>
The maximum amount of TEXT or IMAGE 
data returned by sybnext is ultimately dependent on sybtcl's ability to 
malloc() <I>maxtext </I> bytes of memory for each TEXT or IMAGE column retrieved. 
 Setting sybmsg(maxtext) to too high a value may cause core dumps or memory 
shortages.  Sybreadtext does not malloc() an area to hold the entire value; 
instead it retrieves TEXT and IMAGE in chunks and writes to a file.  While 
maxtext limits the amount of data retrieved by sybreadtext, it shouldn't 
cause memory shortages as sybnext might.  <P>
When using sybnext with the optional 
tcl-commands argument, a substantial performance improvement can be realized 
by not using the substitution values (@1, @2, etc.)  Instead, specify the 
substitution character as a  null string {}, and use the tclvar-columnum 
argument pairs.  <P>
 
<H2><A NAME="sect5" HREF="#toc5">Environment Variables </A></H2>

<DL>

<DT>DSQUERY  </DT>
<DD> <BR>
The default Sybase server. 
</DD>

<DT>SYBASE  </DT>
<DD> <BR>
The home directory for Sybase files.  <P>
</DD>
</DL>
 
<H2><A NAME="sect6" HREF="#toc6">Files </A></H2>

<DL>

<DT>$SYBASE/interfaces 
- definitions for Sybase Servers.  </DT>
<DD> <P>
</DD>
</DL>
 
<H2><A NAME="sect7" HREF="#toc7">Author </A></H2>
Tom Poindexter, Denver Colorado 
&lt;tpoindex@nyx.net&gt;,  Currently maintained by D. J. Hagberg &lt;dhagberg@millibits.com&gt;. 
Version 3.0 released December, 2000. The ?commands? option to sybnext was 
borrowed from my work with Oratcl, a Tcl interface to the Oracle database 
product.  <BR>
<A HREF="http://sybtcl.sourceforge.net/">http://sybtcl.sourceforge.net/</A>
  <BR>
<A HREF="http://www.nyx.net/~tpoindex">http://www.nyx.net/~tpoindex</A>
  
<!--
 
 <P>

<HR><P>
<A NAME="toc"><B>Table of Contents</B></A><P>
<UL>
<LI><A NAME="toc0" HREF="#sect0">Name</A></LI>
<LI><A NAME="toc1" HREF="#sect1">Introduction</A></LI>
<LI><A NAME="toc2" HREF="#sect2">Sybtcl Commands</A></LI>
<LI><A NAME="toc3" HREF="#sect3">Server Message and Error Information</A></LI>
<LI><A NAME="toc4" HREF="#sect4">Notes</A></LI>
<LI><A NAME="toc5" HREF="#sect5">Environment Variables</A></LI>
<LI><A NAME="toc6" HREF="#sect6">Files</A></LI>
<LI><A NAME="toc7" HREF="#sect7">Author</A></LI>
</UL>
</BODY></HTML>
